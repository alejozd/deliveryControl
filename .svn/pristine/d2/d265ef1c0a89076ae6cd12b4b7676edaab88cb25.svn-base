import React, { useState, useEffect } from "react";
import { Dialog } from "primereact/dialog";
import { Button } from "primereact/button";
import axios from "axios";

const WhatsAppDialog = ({ visible, onHide, selectedQuote }) => {
  const [contacts, setContacts] = useState([]);
  const [selectedContact, setSelectedContact] = useState(null);

  useEffect(() => {
    if (selectedQuote) {
      const fetchContacts = async () => {
        try {
          const response = await axios.get(
            `/api/contacts?clienteId=${selectedQuote.clienteId}`
          );
          setContacts(response.data);
        } catch (error) {
          console.error("Error fetching contacts:", error);
        }
      };
      fetchContacts();
    }
  }, [selectedQuote]);

  const sendMessage = () => {
    const phoneNumber = selectedContact
      ? selectedContact.telmovilCa
      : selectedQuote.telmovil;
    const message = encodeURIComponent("Your custom message here");
    window.open(`https://wa.me/${phoneNumber}?text=${message}`, "_blank");
    onHide();
  };

  return (
    <Dialog
      header="Enviar mensaje por WhatsApp"
      visible={visible}
      style={{ width: "50vw" }}
      onHide={onHide}
    >
      <div>
        <h3>Seleccionar contacto</h3>
        <div>
          <input
            type="radio"
            name="contactOption"
            value="cliente"
            onChange={() => setSelectedContact(null)}
          />
          <label>Enviar al tel√©fono del cliente</label>
        </div>
        {contacts.map((contact) => (
          <div key={contact.idcontacto}>
            <input
              type="radio"
              name="contactOption"
              value={contact.idcontacto}
              onChange={() => setSelectedContact(contact)}
            />
            <label>
              {contact.nombreCa} - {contact.telmovilCa}
            </label>
          </div>
        ))}
      </div>
      <Button
        label="Enviar"
        icon="pi pi-check"
        severity="success"
        onClick={sendMessage}
      />
    </Dialog>
  );
};

export default WhatsAppDialog;
