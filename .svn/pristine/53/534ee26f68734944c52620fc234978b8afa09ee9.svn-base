import React, { useState } from 'react';
import { DataTable } from 'primereact/datatable';
import { Column } from 'primereact/column';
import { Panel } from 'primereact/panel';
import { Calendar } from 'primereact/calendar';
import { Button } from 'primereact/button';
import { Toolbar } from 'primereact/toolbar';
import { addLocale } from 'primereact/api';
import axios from 'axios';

const ConsultaEntregas = () => {
    const [entregas, setEntregas] = useState([]);
    const [loading, setLoading] = useState(true);
    const [fechaIni, setFechaIni] = useState(null);
    const [fechaFin, setFechaFin] = useState(null);

    addLocale('es', {
        firstDayOfWeek: 1,
        showMonthAfterYear: true,
        dayNames: ['domingo', 'lunes', 'martes', 'miércoles', 'jueves', 'viernes', 'sábado'],
        dayNamesShort: ['dom', 'lun', 'mar', 'mié', 'jue', 'vie', 'sáb'],
        dayNamesMin: ['D', 'L', 'M', 'X', 'J', 'V', 'S'],
        monthNames: ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'],
        monthNamesShort: ['ene', 'feb', 'mar', 'abr', 'may', 'jun', 'jul', 'ago', 'sep', 'oct', 'nov', 'dic'],
        today: 'Hoy',
        clear: 'Limpiar'
    });

    const handleSearch = async () => {
        try {
            setLoading(true);
            const requestData = {
                FECHAINI: fechaIni.toLocaleDateString("es-CO"),
                FECHAFIN: fechaFin.toLocaleDateString("es-CO"),
            };
            console.log('JSON enviado al backend:', requestData);
            const response = await axios.put('http://localhost:8080/Datasnap/rest/TServerMethods1/ListaEntregas', requestData);

            if (response.data.status === 200) {
                setEntregas(response.data.data);
            } else {
                console.error('Error en la respuesta:', response.data.error);
            }
        } catch (error) {
            console.error('Error al realizar la solicitud:', error.message);
        } finally {
            setLoading(false);
        }
    };

    return (
        <div>
            <Panel header="Consulta de Entregas" toggleable>
                <Toolbar
                    start={
                        <>
                            <Calendar value={fechaIni} onChange={(e) => setFechaIni(e.value)} locale="es" showIcon />
                            <Calendar value={fechaFin} onChange={(e) => setFechaFin(e.value)} locale="es" showIcon />
                        </>
                    }
                    end={
                        <>
                            <Button label="Buscar" icon="pi pi-search" className="p-mt-2" onClick={handleSearch} />
                        </>
                    }
                />
            </Panel>
            <DataTable value={entregas} showGridlines stripedRows className="p-datatable-sm"
                paginator rows={5} rowsPerPageOptions={[5, 10, 25, 50]}>
                <Column field="nombrecliente" header="Nombre Cliente" />
                <Column field="numeroentrega" header="Número Entrega" />
                <Column field="fechaentrega" header="Fecha Entrega" />
                <Column field="numfactura" header="Número Factura" />
                <Column field="fechafactura" header="Fecha Factura" />
                <Column field="vendedor" header="Vendedor" />
            </DataTable>
        </div>
    );
};

export default ConsultaEntregas;