import { useState } from "react";
import { Dropdown } from "primereact/dropdown";
import { Card } from "primereact/card";
import { DataTable } from "primereact/datatable";
import { Column } from "primereact/column";
import { Sidebar } from "primereact/sidebar";
import { BarChart, Bar, XAxis, YAxis, Tooltip } from "recharts";

const SalesDashboard = () => {
  const [selectedSegment, setSelectedSegment] = useState(null);
  const [showSidebar, setShowSidebar] = useState(false);
  const [selectedClient, setSelectedClient] = useState(null);

  const segmentOptions = [
    { label: "Arquitectos", value: "Arquitectos" },
    { label: "Maestros", value: "Maestros" },
    { label: "Constructoras", value: "Constructoras" },
  ];

  const clients = [
    { id: 1, nombre: "Cliente A", compras: 10, ultimaCompra: "2024-02-01" },
    { id: 2, nombre: "Cliente B", compras: 15, ultimaCompra: "2024-01-15" },
  ];

  const ventasPorSegmento = [
    { segmento: "Arquitectos", totalVentas: 500 },
    { segmento: "Maestros", totalVentas: 300 },
    { segmento: "Constructoras", totalVentas: 700 },
  ];

  const openSidebar = (client) => {
    setSelectedClient(client);
    setShowSidebar(true);
  };

  return (
    <div className="p-5">
      <h2 className="mb-4">Dashboard de Ventas</h2>

      {/* Selección de Segmento */}
      <Dropdown
        value={selectedSegment}
        options={segmentOptions}
        onChange={(e) => setSelectedSegment(e.value)}
        placeholder="Selecciona un segmento"
        className="mb-4 w-full md:w-30rem"
      />

      {/* KPIs */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Card title="Total Facturas">
          <h2>1,200</h2>
        </Card>
        <Card title="Ticket Promedio">
          <h2>$2,350</h2>
        </Card>
        <Card title="Clientes Activos">
          <h2>85</h2>
        </Card>
      </div>

      {/* Tabla de Clientes */}
      <h3 className="mt-6">Clientes del Segmento</h3>
      <DataTable value={clients} paginator rows={5} className="mt-3">
        <Column
          field="nombre"
          header="Cliente"
          sortable
          body={(rowData) => (
            <span
              className="cursor-pointer text-blue-500"
              onClick={() => openSidebar(rowData)}
            >
              {rowData.nombre}
            </span>
          )}
        />
        <Column field="compras" header="Total Compras" sortable />
        <Column field="ultimaCompra" header="Última Compra" sortable />
      </DataTable>

      {/* Gráfico de Ventas */}
      <h3 className="mt-6">Ventas por Segmento</h3>
      <BarChart
        width={500}
        height={300}
        data={ventasPorSegmento}
        className="mt-3"
      >
        <XAxis dataKey="segmento" />
        <YAxis />
        <Tooltip />
        <Bar dataKey="totalVentas" fill="#3B82F6" />
      </BarChart>

      {/* Sidebar con Detalle del Cliente */}
      <Sidebar
        visible={showSidebar}
        position="right"
        onHide={() => setShowSidebar(false)}
      >
        {selectedClient && (
          <>
            <h3>{selectedClient.nombre}</h3>
            <p>Total Compras: {selectedClient.compras}</p>
            <p>Última Compra: {selectedClient.ultimaCompra}</p>
          </>
        )}
      </Sidebar>
    </div>
  );
};

export default SalesDashboard;
